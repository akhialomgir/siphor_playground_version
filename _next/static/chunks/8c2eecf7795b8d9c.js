(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37372,e=>{e.v({deductions:{scoreType:"deduction",items:[{id:"0",name:"bili",score:15,type:"fixed"},{id:"1",name:"game",type:"tiered",baseType:"duration",criteria:[{time:1800,score:10}]},{id:"2",name:"sosx",score:50,type:"fixed"}]},regularGains:{scoreType:"gain",items:[{id:"0",name:"focus",type:"tiered",baseType:"duration",criteria:[{time:3600,score:5},{time:7200,score:10},{time:10800,score:20},{time:14400,score:25},{time:18e3,score:35}]},{id:"1",name:"exercise",score:10,type:"fixed"},{id:"2",name:"sleep",type:"conditional",baseType:"relativeTime",criteria:[{time:79200,comparison:"before",score:5},{time:82800,comparison:"before",score:10}]}]},targetGains:{scoreType:"gain",items:[{id:"0",name:"programming",score:15,type:"fixed"},{id:"1",name:"algorithm",score:15,type:"fixed"},{id:"2",name:"interview",score:20,type:"fixed"},{id:"3",name:"paint",score:10,type:"fixed"},{id:"4",name:"reading",score:5,type:"fixed"},{id:"5",name:"mindfulness",score:10,type:"fixed"}]}})},5987,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let i=(0,r.createContext)(void 0);function n({children:e}){let[n,o]=(0,r.useState)(new Set),s=(0,r.useCallback)(e=>o(new Set(e)),[]),a=(0,r.useMemo)(()=>({selectedIds:n,replaceAll:s}),[n,s]);return(0,t.jsx)(i.Provider,{value:a,children:e})}function o(){let e=(0,r.useContext)(i);if(!e)throw Error("useDroppedItems must be used within DroppedItemsProvider");return e}e.s(["DroppedItemsProvider",()=>n,"useDroppedItems",()=>o])},24335,e=>{"use strict";var t=e.i(43476),r=e.i(71645),i=e.i(37372),n=e.i(5987);function o(){let[e,o]=(0,r.useState)(null),{selectedIds:s}=(0,n.useDroppedItems)();if((0,r.useEffect)(()=>{o(i.default)},[]),!e)return(0,t.jsx)("div",{children:"Loading..."});let a={padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:500},d={pts:{backgroundColor:"#113227",color:"#6ee7b7"},time:{backgroundColor:"#10233d",color:"#93c5fd"}},l=({variant:e,children:r})=>(0,t.jsx)("span",{style:{...a,...d[e]},children:r}),c=({children:e})=>(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:e});return(0,t.jsx)("div",{style:{padding:"20px",fontFamily:"system-ui, -apple-system, sans-serif",backgroundColor:"#0b1220",color:"#e5e7eb"},children:(0,t.jsx)("div",{style:{display:"grid",gap:"20px"},children:Object.entries(e).map(([e,r])=>(0,t.jsxs)("div",{style:{border:"2px solid #243046",borderRadius:"8px",overflow:"hidden",backgroundColor:"#0f1625",boxShadow:"0 6px 20px rgba(0,0,0,0.35)"},children:[(0,t.jsxs)("div",{style:{backgroundColor:"#111827",padding:"12px 16px",borderBottom:"2px solid #243046",fontWeight:600,fontSize:"16px",color:"#e5e7eb"},children:[{deductions:"Deductions",regularGains:"Regular Gains",targetGains:"Target Gains"}[e]||e,(0,t.jsxs)("span",{style:{marginLeft:"12px",fontSize:"12px",color:"#94a3b8"},children:["(","gain"===r.scoreType?"Gain":"Deduction",")"]})]}),(0,t.jsx)("div",{children:r.items.map((i,n)=>{let o=i.criteria&&i.criteria.length>0,a=(e=>{if(!e.criteria||0===e.criteria.length)return null;let r=e.criteria.map((r,i)=>{let n="";if("duration"===e.baseType){var o;let e,t;e=Math.floor((o=r.time)/3600),t=Math.floor(o%3600/60),n=e>0?t>0?`${e}h${t}m`:`${e}h`:`${t}m`}else if("relativeTime"===e.baseType){let e=new Date(0);e.setSeconds(r.time);let t=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});n=`${r.comparison} ${t}`}return(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"8px"},children:[n&&(0,t.jsx)(l,{variant:"time",children:n}),(0,t.jsxs)(l,{variant:"pts",children:[r.score," pts"]})]},`${e.id}-crit-${i}-${r.time}-${r.score}`)});if(r.length>2){let i=[];for(let n=0;n<r.length;n+=2){let o=r.slice(n,n+2);i.push((0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:o},`crit-col-${e.id}-${n}`))}return(0,t.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",flexWrap:"wrap",gap:"8px"},children:i})}return(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:r})})(i),d=`${e}-${i.id}`,p=s.has(d);return(0,t.jsxs)("div",{draggable:!0,onDragStart:t=>{let n={id:`${e}-${i.id}`,name:i.name,scoreType:"gain"===r.scoreType?"gain":"deduction",score:i.score,criteria:i.criteria??[],baseType:i.baseType,categoryKey:e};t.dataTransfer.setData("application/json",JSON.stringify(n))},style:{borderBottom:n<r.items.length-1?"1px solid #1f2937":"none",padding:"12px 16px",display:"grid",gridTemplateColumns:"1fr auto",gap:"8px",...p?{backgroundColor:"rgba(110, 231, 183, 0.14)",outline:"1px solid rgba(110, 231, 183, 0.28)",borderRadius:"6px"}:{}},children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{marginBottom:o?"8px":"0"},children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#e5e7eb"},children:i.name}),(0,t.jsxs)("span",{style:{marginLeft:"8px",color:"#94a3b8",fontSize:"12px"},children:["(ID: ",i.id,")"]})]}),i.type&&(0,t.jsx)("span",{style:{display:"inline-block",backgroundColor:"#1f2937",padding:"2px 6px",borderRadius:"3px",fontSize:"12px",color:"#cbd5e1"},children:i.type})]}),(0,t.jsxs)(c,{children:["number"==typeof i.score&&(0,t.jsxs)(l,{variant:"pts",children:[i.score," pts"]}),a]})]},i.id)})})]},e))})})}e.s(["default",()=>o])},89431,e=>{e.v({"clear-wiggle":"DragDropBox-module__HXSG-G__clear-wiggle",clearButton:"DragDropBox-module__HXSG-G__clearButton",clearButtonActive:"DragDropBox-module__HXSG-G__clearButtonActive",dateChip:"DragDropBox-module__HXSG-G__dateChip",entry:"DragDropBox-module__HXSG-G__entry","entry-glow":"DragDropBox-module__HXSG-G__entry-glow",entryHighlight:"DragDropBox-module__HXSG-G__entryHighlight",section:"DragDropBox-module__HXSG-G__section"})},60057,e=>{"use strict";var t=e.i(43476),r=e.i(71645),i=e.i(89431),n=e.i(5987);let o="entries";function s(){return new Promise((e,t)=>{if(!window.indexedDB)return void t(Error("IndexedDB not available"));let r=indexedDB.open("dragDropBox",1);r.onupgradeneeded=()=>{let e=r.result;e.objectStoreNames.contains(o)||e.createObjectStore(o)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error??Error("Failed to open IndexedDB"))})}async function a(e){try{let t=await s();return await new Promise((r,i)=>{let n=t.transaction(o,"readonly").objectStore(o).get(e);n.onsuccess=()=>{let e=n.result??{deductions:[],gains:[]};r({deductions:e.deductions??[],gains:e.gains??[]})},n.onerror=()=>i(n.error??Error("Read failed"))})}catch(e){return{deductions:[],gains:[]}}}async function d(e,t,r){try{let i=await s();await new Promise((n,s)=>{let a=i.transaction(o,"readwrite").objectStore(o).put({deductions:t,gains:r},e);a.onsuccess=()=>n(),a.onerror=()=>s(a.error??Error("Write failed"))})}catch(e){}}async function l(e){try{let t=await s();await new Promise((r,i)=>{let n=t.transaction(o,"readwrite").objectStore(o).delete(e);n.onsuccess=()=>r(),n.onerror=()=>i(n.error??Error("Delete failed"))})}catch(e){}}let c={padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:500},p={backgroundColor:"#113227",color:"#6ee7b7"},u=({value:e})=>(0,t.jsxs)("span",{style:{...c,...p},children:[e," pts"]});function x(e){if(e.criteria&&e.criteria.length>0){let t=Math.max(0,e.selectedIndex??0);return(e.criteria[t]?.score??0)+10*!!e.bonusActive}return(e.fixedScore??0)+10*!!e.bonusActive}function g(){let[e,o]=(0,r.useState)([]),[s,c]=(0,r.useState)([]),[p,g]=(0,r.useState)(()=>new Date().toISOString().slice(0,10)),[m,f]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!1),h=(0,r.useRef)(null),{replaceAll:v}=(0,n.useDroppedItems)();(0,r.useEffect)(()=>{v([...e,...s].map(e=>e.id))},[e,s,v]),(0,r.useEffect)(()=>{let e=!0;return a(p).then(t=>{if(!e)return;let r=e=>e.map(e=>({...e,justAdded:!1}));o(r(t.deductions??[])),c(r(t.gains??[])),f(!0)}).catch(()=>{f(!0)}),()=>{e=!1}},[p]),(0,r.useEffect)(()=>{m&&p&&d(p,e,s)},[e,s,m,p]);let j=()=>{h.current&&(window.clearTimeout(h.current),h.current=null),b(!1)},S={display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:"8px",padding:"8px 10px",borderBottom:"1px solid #1f2937"},D=(e,r)=>{let n=x(e),s=!!e.criteria&&e.criteria.length>0,a="targetGains"===e.categoryKey&&"gain"===e.scoreType;return(0,t.jsxs)("div",{style:S,className:`${i.default.entry} ${e.justAdded?i.default.entryHighlight:""}`,children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#e5e7eb"},children:e.name}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a&&(0,t.jsx)("button",{onClick:()=>{"deduction"===r?o(t=>t.map(t=>t.id===e.id?{...t,bonusActive:!t.bonusActive}:t)):c(t=>t.map(t=>t.id===e.id?{...t,bonusActive:!t.bonusActive}:t))},style:{border:"none",background:e.bonusActive?"#2d1a1e":"#113227",color:e.bonusActive?"#fca5a5":"#6ee7b7",padding:"4px 8px",borderRadius:"4px",cursor:"pointer",fontWeight:600,fontSize:"12px"},"aria-label":"Toggle bonus",children:e.bonusActive?"✕":"+10"}),s?(0,t.jsxs)("div",{style:{position:"relative",display:"inline-flex",alignItems:"center"},children:[(0,t.jsx)("select",{value:e.selectedIndex??0,onChange:t=>{var i,n;return i=e.id,n=parseInt(t.target.value,10),void("deduction"===r?o(e=>e.map(e=>e.id===i?{...e,selectedIndex:n}:e)):c(e=>e.map(e=>e.id===i?{...e,selectedIndex:n}:e)))},style:{fontSize:"12px",padding:"4px 28px 4px 8px",borderRadius:"4px",border:"none",backgroundColor:"#113227",color:"#6ee7b7",fontWeight:500,cursor:"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",outline:"none"},children:e.criteria.map((r,i)=>(0,t.jsxs)("option",{value:i,children:[r.score," pts"]},`${e.id}-opt-${i}`))}),(0,t.jsx)("span",{style:{position:"absolute",right:"8px",pointerEvents:"none",color:"#e5e7eb",fontSize:"12px"},children:"▾"})]}):(0,t.jsx)(u,{value:n}),(0,t.jsx)("button",{onClick:()=>{"deduction"===r?o(t=>t.filter(t=>t.id!==e.id)):c(t=>t.filter(t=>t.id!==e.id))},style:{border:"none",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:"12px",padding:"2px 6px"},"aria-label":"Remove item",children:"✕"})]})]},`${r}-${e.id}`)};return(0,t.jsxs)("div",{className:i.default.section,style:{border:"2px dashed #2d3b55",borderRadius:"8px",padding:"16px",minHeight:"360px",backgroundColor:"#0f1625",color:"#e5e7eb",boxShadow:"0 6px 20px rgba(0,0,0,0.35)"},onDragOver:e=>{e.preventDefault()},onDrop:e=>{let t,r;e.preventDefault();let{key:i,changed:n}=((r=(t=new Date().toISOString().slice(0,10))!==p)&&(g(t),o([]),c([]),f(!1)),{key:t,changed:r});if(n)return;let s=e.dataTransfer.getData("application/json");if(s||(s=e.dataTransfer.getData("text/plain")),s)try{let e=JSON.parse(s),t={id:e.id,name:e.name,scoreType:e.scoreType,criteria:e.criteria,baseType:e.baseType,fixedScore:e.score,selectedIndex:0,categoryKey:e.categoryKey,bonusActive:!1};"deduction"===t.scoreType?o(e=>{if(e.some(e=>e.id===t.id))return e;let r={...t,justAdded:!0};return setTimeout(()=>{o(e=>e.map(e=>e.id===r.id?{...e,justAdded:!1}:e))},950),[...e,r]}):c(e=>{if(e.some(e=>e.id===t.id))return e;let r={...t,justAdded:!0};return setTimeout(()=>{c(e=>e.map(e=>e.id===r.id?{...e,justAdded:!1}:e))},950),[...e,r]})}catch(e){}},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,t.jsx)("div",{className:i.default.dateChip,children:(e=>{if(!e)return"";let[t,r,i]=e.split("-");return`${t}-${r}-${i}`})(p)||"—"}),(0,t.jsx)("div",{style:{color:"#94a3b8",fontSize:"12px"},children:"每日记录"})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1px 1fr",gap:"16px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:"8px",color:"#e5e7eb"},children:"Deductions"}),0===e.length?(0,t.jsx)("div",{style:{color:"#94a3b8",fontSize:"12px"},children:"Drop items here"}):e.map(e=>D(e,"deduction"))]}),(0,t.jsx)("div",{style:{backgroundColor:"#1f2937",width:"1px"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:"8px",color:"#e5e7eb"},children:"Gains"}),0===s.length?(0,t.jsx)("div",{style:{color:"#94a3b8",fontSize:"12px"},children:"Drop items here"}):s.map(e=>D(e,"gain"))]})]}),(0,t.jsxs)("div",{style:{marginTop:"12px",borderTop:"1px solid #1f2937",paddingTop:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("span",{style:{color:"#94a3b8",fontSize:"12px"},children:"Total"}),(0,t.jsx)(u,{value:s.reduce((e,t)=>e+x(t),0)-e.reduce((e,t)=>e+x(t),0)})]}),(0,t.jsx)("button",{className:`${i.default.clearButton} ${y?i.default.clearButtonActive:""}`,onPointerDown:()=>{h.current&&window.clearTimeout(h.current),b(!0),h.current=window.setTimeout(()=>{h.current=null,o([]),c([]),p&&l(p),b(!1)},3e3)},onPointerUp:j,onPointerLeave:j,onPointerCancel:j,"aria-label":"Clear all dropped items",children:"Clear"})]})}e.s(["default",()=>g],60057)}]);