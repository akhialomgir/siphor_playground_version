(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5987,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let a=(0,r.createContext)(void 0);function n({children:e}){let[n,i]=(0,r.useState)(new Set),[o,l]=(0,r.useState)(0),s=(0,r.useCallback)(e=>{i(t=>{if(t.size!==e.length)return new Set(e);for(let r of e)if(!t.has(r))return new Set(e);return t})},[]),d=(0,r.useCallback)(()=>l(e=>e+1),[]),c=(0,r.useMemo)(()=>({selectedIds:n,replaceAll:s,weeklyGoalsVersion:o,notifyWeeklyGoalsUpdate:d}),[n,s,o,d]);return(0,t.jsx)(a.Provider,{value:c,children:e})}function i(){let e=(0,r.useContext)(a);if(!e)throw Error("useDroppedItems must be used within DroppedItemsProvider");return e}e.s(["DroppedItemsProvider",()=>n,"useDroppedItems",()=>i])},32833,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let a=(0,r.createContext)(void 0);function n({children:e}){let[n,i]=(0,r.useState)(()=>new Date().toISOString().slice(0,10));return(0,t.jsx)(a.Provider,{value:{selectedDate:n,setSelectedDate:i},children:e})}function i(){let e=(0,r.useContext)(a);if(!e)throw Error("useSelectedDate must be used within DateProvider");return e}e.s(["DateProvider",()=>n,"useSelectedDate",()=>i])},55167,e=>{"use strict";let t="entries",r="weeklyGoals";function a(){return new Promise((e,a)=>{if(!window.indexedDB)return void a(Error("IndexedDB not available"));let n=indexedDB.open("dragDropBox",2);n.onupgradeneeded=e=>{let a=n.result,i=e.oldVersion??0;a.objectStoreNames.contains(t)||a.createObjectStore(t),i<2&&!a.objectStoreNames.contains(r)&&a.createObjectStore(r)},n.onsuccess=()=>e(n.result),n.onerror=()=>a(n.error??Error("Failed to open IndexedDB"))})}async function n(e){try{let r=await a();return await new Promise((a,n)=>{let i=r.transaction(t,"readonly").objectStore(t).get(e);i.onsuccess=()=>{let e=i.result??{deductions:[],gains:[]};a({deductions:e.deductions??[],gains:e.gains??[]})},i.onerror=()=>n(i.error??Error("Read failed"))})}catch(e){return{deductions:[],gains:[]}}}async function i(e){try{let t=await a();return await new Promise((a,n)=>{let i=t.transaction(r,"readonly").objectStore(r).get(e);i.onsuccess=()=>{let e=i.result??{goals:{}};a({goals:e.goals??{}})},i.onerror=()=>n(i.error??Error("Read failed"))})}catch(e){return{goals:{}}}}async function o(e,t){try{let n=await a();await new Promise((a,i)=>{let o=n.transaction(r,"readwrite").objectStore(r).put(t,e);o.onsuccess=()=>a(),o.onerror=()=>i(o.error??Error("Write failed"))})}catch(e){}}async function l(e,r,n){try{let i=await a();await new Promise((a,o)=>{let l=i.transaction(t,"readwrite").objectStore(t).put({deductions:r,gains:n},e);l.onsuccess=()=>a(),l.onerror=()=>o(l.error??Error("Write failed"))})}catch(e){}}async function s(e){try{let r=await a();await new Promise((a,n)=>{let i=r.transaction(t,"readwrite").objectStore(t).delete(e);i.onsuccess=()=>a(),i.onerror=()=>n(i.error??Error("Delete failed"))})}catch(e){}}async function d(){try{let e=await a();return await new Promise((r,a)=>{let n=e.transaction(t,"readonly").objectStore(t),i=n.getAllKeys();i.onsuccess=async()=>{let e=i.result.filter(Boolean),t=[],o=e.map(e=>new Promise((r,a)=>{let i=n.get(e);i.onsuccess=()=>{let a=i.result??{deductions:[],gains:[]};t.push({dateKey:e,state:a}),r()},i.onerror=()=>a(i.error??Error("Read failed"))}));try{await Promise.all(o),r(t)}catch(e){a(e)}},i.onerror=()=>a(i.error??Error("List keys failed"))})}catch(e){return[]}}async function c(){try{let e=await a();return await new Promise((t,a)=>{let n=e.transaction(r,"readonly").objectStore(r),i=n.getAllKeys();i.onsuccess=async()=>{let e=i.result.filter(Boolean),r=[],o=e.map(e=>new Promise((t,a)=>{let i=n.get(e);i.onsuccess=()=>{let a=i.result??{goals:{}};r.push({weekKey:e,state:{goals:a.goals??{}}}),t()},i.onerror=()=>a(i.error??Error("Read failed"))}));try{await Promise.all(o),t(r)}catch(e){a(e)}},i.onerror=()=>a(i.error??Error("List keys failed"))})}catch(e){return[]}}async function u(){let e=await d(),t=await c();return{version:"1.0",exportDate:new Date().toISOString(),data:e,weeklyGoals:t}}async function p(e){if(!e.version||!Array.isArray(e.data))throw Error("Invalid import data format");let n=await a();for(let{dateKey:r,state:a}of e.data)await new Promise((e,i)=>{let o=n.transaction(t,"readwrite").objectStore(t).put(a,r);o.onsuccess=()=>e(),o.onerror=()=>i(o.error??Error("Write failed"))});for(let{weekKey:t,state:a}of e.weeklyGoals??[])await new Promise((e,i)=>{let o=n.transaction(r,"readwrite").objectStore(r).put(a,t);o.onsuccess=()=>e(),o.onerror=()=>i(o.error??Error("Write failed"))})}e.s(["clearPersistedState",()=>s,"exportAllData",()=>u,"importAllData",()=>p,"listAllStates",()=>d,"loadPersistedState",()=>n,"loadWeeklyGoals",()=>i,"savePersistedState",()=>l,"saveWeeklyGoals",()=>o])},89050,e=>{"use strict";var t=e.i(37372);function r(e){let r,a=(r=t.default.regularGains.items.find(e=>"focus"===e.name),r?.criteria??[]);for(let t=a.length-1;t>=0;t--)if(e>=a[t].time)return a[t].score;return 0}function a(){let e=[];return Object.values(t.default).forEach(t=>{Array.isArray(t.items)&&t.items.forEach(t=>{t.goals&&Array.isArray(t.goals)&&t.goals.forEach(r=>{"weekly"===r.type&&e.push({id:r.id,name:t.name,type:r.type,targetCount:r.targetCount,rewardPoints:r.rewardPoints,segmentCount:r.targetCount})})})}),e}function n(e){return a().find(t=>t.id===e)}function i(e){let t=new Date(`${e}T00:00:00`),r=t.getDay(),a=new Date(t);a.setDate(t.getDate()-(r+6)%7);let n=a.toISOString().slice(0,10);return`week-${n}`}function o(e,t){if("fixed"===e.type)return(e.score??0)*t;if("tiered"===e.type&&"duration"===e.baseType){let r=e.criteria?.[0];return r?Math.ceil(r.score/r.time*t):0}return 0}e.s(["getDeductionScore",()=>o,"getFocusScore",()=>r,"getWeekKey",()=>i,"getWeeklyGoalById",()=>n,"getWeeklyGoals",()=>a])},24335,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(37372),n=e.i(5987),i=e.i(32833),o=e.i(55167),l=e.i(89050);function s(){let[e,s]=(0,r.useState)(null),[d,c]=(0,r.useState)({goals:{}}),{selectedIds:u,weeklyGoalsVersion:p}=(0,n.useDroppedItems)(),{selectedDate:g}=(0,i.useSelectedDate)();if((0,r.useEffect)(()=>{s(a.default)},[]),(0,r.useEffect)(()=>{let e=new Date().toISOString().slice(0,10),t=(0,l.getWeekKey)(g||e);console.log("[ScoringDisplay] Loading weekly goals, key:",t,"version:",p),(0,o.loadWeeklyGoals)(t).then(e=>{console.log("[ScoringDisplay] Loaded state:",e),c(e)}).catch(()=>c({goals:{}}))},[g,p]),!e)return(0,t.jsx)("div",{children:"Loading..."});let m={padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:500},f={pts:{backgroundColor:"#113227",color:"#6ee7b7"},time:{backgroundColor:"#10233d",color:"#93c5fd"}},x=({variant:e,children:r})=>(0,t.jsx)("span",{style:{...m,...f[e]},children:r}),y=({children:e})=>(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:e});return(0,t.jsx)("div",{style:{padding:"20px",fontFamily:"system-ui, -apple-system, sans-serif",backgroundColor:"#0b1220",color:"#e5e7eb"},children:(0,t.jsx)("div",{style:{display:"grid",gap:"20px"},children:Object.entries(e).map(([e,r])=>(0,t.jsxs)("div",{style:{border:"2px solid #243046",borderRadius:"8px",overflow:"hidden",backgroundColor:"#0f1625",boxShadow:"0 6px 20px rgba(0,0,0,0.35)"},children:[(0,t.jsxs)("div",{style:{backgroundColor:"#111827",padding:"12px 16px",borderBottom:"2px solid #243046",fontWeight:600,fontSize:"16px",color:"#e5e7eb"},children:[{deductions:"Deductions",regularGains:"Regular Gains",targetGains:"Target Gains"}[e]||e,(0,t.jsxs)("span",{style:{marginLeft:"12px",fontSize:"12px",color:"#94a3b8"},children:["(","gain"===r.scoreType?"Gain":"Deduction",")"]})]}),(0,t.jsx)("div",{children:r.items.map((a,n)=>{let i=a.criteria&&a.criteria.length>0,o=(e=>{if(!e.criteria||0===e.criteria.length)return null;let r=e.criteria.map((r,a)=>{let n="";if("duration"===e.baseType){var i;let e,t;e=Math.floor((i=r.time)/3600),t=Math.floor(i%3600/60),n=e>0?t>0?`${e}h${t}m`:`${e}h`:`${t}m`}else if("relativeTime"===e.baseType){let e=new Date(0);e.setSeconds(r.time);let t=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});n=`${r.comparison} ${t}`}return(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"8px"},children:[n&&(0,t.jsx)(x,{variant:"time",children:n}),(0,t.jsxs)(x,{variant:"pts",children:[r.score," pts"]})]},`${e.id}-crit-${a}-${r.time}-${r.score}`)});if(r.length>2){let a=[];for(let n=0;n<r.length;n+=2){let i=r.slice(n,n+2);a.push((0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:i},`crit-col-${e.id}-${n}`))}return(0,t.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",flexWrap:"wrap",gap:"8px"},children:a})}return(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:r})})(a),l=`${e}-${a.id}`,s=u.has(l),c=a.goals?.find(e=>"weekly"===e.type),p=c?.id,g=p&&d.goals[p]?d.goals[p]:void 0,m=c?c.targetCount:0,f=c?Math.min(g?.count??0,c.targetCount):0;return(0,t.jsxs)("div",{draggable:!0,onDragStart:t=>{let n={id:`${e}-${a.id}`,name:a.name,scoreType:"gain"===r.scoreType?"gain":"deduction",score:a.score,criteria:a.criteria??[],baseType:a.baseType,categoryKey:e,weeklyGoalId:p};t.dataTransfer.setData("application/json",JSON.stringify(n))},style:{borderBottom:n<r.items.length-1?"1px solid #1f2937":"none",padding:"12px 16px",display:"grid",gridTemplateColumns:"1fr auto",rowGap:"6px",columnGap:"8px",...s?{backgroundColor:"rgba(110, 231, 183, 0.14)",outline:"1px solid rgba(110, 231, 183, 0.28)",borderRadius:"6px"}:{}},children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{marginBottom:i?"8px":"0"},children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#e5e7eb"},children:a.name}),(0,t.jsxs)("span",{style:{marginLeft:"8px",color:"#94a3b8",fontSize:"12px"},children:["(ID: ",a.id,")"]})]}),a.type&&(0,t.jsx)("span",{style:{display:"inline-block",backgroundColor:"#1f2937",padding:"2px 6px",borderRadius:"3px",fontSize:"12px",color:"#cbd5e1"},children:a.type})]}),(0,t.jsxs)(y,{children:["number"==typeof a.score&&(0,t.jsxs)(x,{variant:"pts",children:[a.score," pts"]}),c&&(0,t.jsxs)(x,{variant:"pts",children:[c.rewardPoints," pts"]}),o]}),c&&m>0&&(0,t.jsxs)("div",{style:{gridColumn:"1 / -1",display:"flex",alignItems:"center",gap:"8px",justifyContent:"flex-end"},children:[(0,t.jsx)("div",{style:{display:"grid",gridTemplateColumns:`repeat(${m}, 1fr)`,gap:"4px",width:"100%",maxWidth:"260px"},children:Array.from({length:m}).map((e,r)=>{let n=r<f;return(0,t.jsx)("div",{style:{height:"6px",borderRadius:"4px",background:n?"#22c55e":"#1f2937",border:"1px solid #1f2937"}},`${a.id}-seg-${r}`)})}),(0,t.jsxs)("span",{style:{color:"#cbd5e1",fontSize:"12px",whiteSpace:"nowrap",marginLeft:"8px"},children:[f,"/",c.targetCount]})]})]},a.id)})})]},e))})})}e.s(["default",()=>s])},89431,e=>{e.v({"clear-wiggle":"DragDropBox-module__HXSG-G__clear-wiggle",clearButton:"DragDropBox-module__HXSG-G__clearButton",clearButtonActive:"DragDropBox-module__HXSG-G__clearButtonActive",dateChip:"DragDropBox-module__HXSG-G__dateChip",entry:"DragDropBox-module__HXSG-G__entry","entry-glow":"DragDropBox-module__HXSG-G__entry-glow",entryHighlight:"DragDropBox-module__HXSG-G__entryHighlight",section:"DragDropBox-module__HXSG-G__section"})},36999,e=>{e.v({calendarContainer:"Calendar-module__rMASNW__calendarContainer",calendarHeader:"Calendar-module__rMASNW__calendarHeader",calendarOverlay:"Calendar-module__rMASNW__calendarOverlay",day:"Calendar-module__rMASNW__day",days:"Calendar-module__rMASNW__days",empty:"Calendar-module__rMASNW__empty",fadeIn:"Calendar-module__rMASNW__fadeIn",future:"Calendar-module__rMASNW__future",hasData:"Calendar-module__rMASNW__hasData",monthYear:"Calendar-module__rMASNW__monthYear",navButton:"Calendar-module__rMASNW__navButton",noData:"Calendar-module__rMASNW__noData",selected:"Calendar-module__rMASNW__selected",slideUp:"Calendar-module__rMASNW__slideUp",weekday:"Calendar-module__rMASNW__weekday",weekdays:"Calendar-module__rMASNW__weekdays"})},60057,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(89431),n=e.i(5987),i=e.i(55167),o=e.i(36999);function l(e){if(e.criteria&&e.criteria.length>0){let t=Math.max(0,e.selectedIndex??0);return(e.criteria[t]?.score??0)+10*!!e.bonusActive}return(e.fixedScore??0)+10*!!e.bonusActive}function s({selectedDate:e,onDateSelect:a,onClose:n}){let[s,d]=(0,r.useState)(()=>{let[t,r,a]=e.split("-").map(Number);return new Date(t,r-1,a)}),[c,u]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{(0,i.listAllStates)().then(e=>{let t=new Set;e.forEach(({dateKey:e,state:r})=>{0!=(r.gains??[]).reduce((e,t)=>e+l(t),0)-(r.deductions??[]).reduce((e,t)=>e+l(t),0)&&t.add(e)}),u(t)})},[]);let p=s.getFullYear(),g=s.getMonth(),m=new Date(p,g,1),f=new Date(p,g+1,0).getDate(),x=m.getDay(),y=[];for(let e=0;e<x;e++)y.push(null);for(let e=1;e<=f;e++)y.push(e);let b=new Intl.DateTimeFormat("en-US",{month:"long"}).format(s),h=e=>{let t=`${p}-${String(g+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`;return c.has(t)},S=e=>{let t=new Date(p,g,e),r=new Date;return r.setHours(0,0,0,0),t>r};return(0,t.jsx)("div",{className:o.default.calendarOverlay,onClick:n,children:(0,t.jsxs)("div",{className:o.default.calendarContainer,onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:o.default.calendarHeader,children:[(0,t.jsx)("button",{onClick:()=>{d(new Date(p,g-1,1))},className:o.default.navButton,"aria-label":"Previous month",children:"â€¹"}),(0,t.jsxs)("div",{className:o.default.monthYear,children:[b," ",p]}),(0,t.jsx)("button",{onClick:()=>{d(new Date(p,g+1,1))},className:o.default.navButton,"aria-label":"Next month",children:"â€º"})]}),(0,t.jsx)("div",{className:o.default.weekdays,children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,t.jsx)("div",{className:o.default.weekday,children:e},e))}),(0,t.jsx)("div",{className:o.default.days,children:y.map((r,i)=>(0,t.jsx)("div",{className:`${o.default.day} ${null===r?o.default.empty:""} ${r&&`${p}-${String(g+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`===e?o.default.selected:""} ${r&&h(r)?o.default.hasData:""} ${r&&S(r)?o.default.future:""} ${r&&!h(r)&&!S(r)?o.default.noData:""}`,onClick:()=>null!==r&&void(a(`${p}-${String(g+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`),n()),role:null!==r?"button":void 0,tabIndex:null!==r?0:void 0,children:r},i))})]})})}var d=e.i(32833),c=e.i(89050),u=e.i(37372);let p={padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:500},g={backgroundColor:"#113227",color:"#6ee7b7"},m=({value:e})=>(0,t.jsxs)("span",{style:{...p,...g},children:[e," pts"]});function f(e){if("deduction"===e.scoreType&&h(e.name))return-(e.customScore??0);if("deduction"===e.scoreType&&"targetGains"!==e.categoryKey){let t=u.default.deductions.items.find(t=>t.name===e.name);if(t?.type==="fixed")return(t.score??0)*(e.count??1);if(t?.type==="tiered"&&"duration"===t.baseType)return(0,c.getDeductionScore)(t,e.timerSeconds??0)}if(e.criteria&&e.criteria.length>0){let t=Math.max(0,e.selectedIndex??0);return(e.criteria[t]?.score??0)+10*!!e.bonusActive}return(e.fixedScore??0)+10*!!e.bonusActive}function x(e){let t=Math.max(0,Math.floor(e)),r=Math.floor(t/3600),a=Math.floor(t%3600/60);return`${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`}function y(e){return e.filter(e=>"targetGains"===e.categoryKey).reduce((e,t)=>e+(t.timerSeconds??0),0)}function b(e){let t=u.default.deductions.items.find(t=>t.name===e);return t?.type==="tiered"&&"duration"===t.baseType}function h(e){let t=u.default.deductions.items.find(t=>t.name===e);return t?.type==="custom"}function S(){let[e,o]=(0,r.useState)([]),[l,p]=(0,r.useState)([]),{selectedDate:g,setSelectedDate:S}=(0,d.useSelectedDate)(),[v,w]=(0,r.useState)(!1),[j,_]=(0,r.useState)(!1),[D,k]=(0,r.useState)(!1),[T,C]=(0,r.useState)(null),[I,R]=(0,r.useState)(null),[$,A]=(0,r.useState)(0),[G,W]=(0,r.useState)(0),[E,N]=(0,r.useState)(null),[M,P]=(0,r.useState)(()=>(0,c.getWeekKey)(new Date().toISOString().slice(0,10))),[H,B]=(0,r.useState)({goals:{}}),z=(0,r.useRef)(null),L=(0,r.useRef)(null),K=(0,r.useRef)(null),{replaceAll:O,notifyWeeklyGoalsUpdate:F}=(0,n.useDroppedItems)();L.current=F,K.current=O;let U=()=>g===new Date().toISOString().slice(0,10),X=U(),J=e=>{S(e),w(!1)};(0,r.useEffect)(()=>{let e=new Date().toISOString().slice(0,10),t=(0,c.getWeekKey)(g||e);P(t),(0,i.loadWeeklyGoals)(t).then(e=>{B(e)}).catch(()=>{B({goals:{}})})},[g]),(0,r.useEffect)(()=>{let t=[...e,...l].map(e=>e.id);K.current?.(t)},[e,l]),(0,r.useEffect)(()=>{if(v){if(!X){C(null),R(null),p(e=>e.some(e=>"targetGains"===e.categoryKey&&(e.timerRunning||e.timerStartTs))?e.map(e=>"targetGains"===e.categoryKey?{...e,timerRunning:!1,timerStartTs:null}:e):e),o(e=>e.some(e=>b(e.name)&&(e.timerRunning||e.timerStartTs))?e.map(e=>b(e.name)?{...e,timerRunning:!1,timerStartTs:null}:e):e);return}p(e=>{let t=e.filter(e=>"targetGains"===e.categoryKey),r=t[t.length-1],a=r?.id??null;C(a);let n=Date.now(),i=!1,o=e.map(e=>"targetGains"!==e.categoryKey?e:e.id===a?e.timerRunning&&!e.timerStartTs?(i=!0,{...e,timerStartTs:n}):!1===e.timerRunning&&e.timerStartTs?(i=!0,{...e,timerStartTs:null}):e:e.timerRunning||e.timerStartTs||e.timerPaused?(i=!0,{...e,timerRunning:!1,timerStartTs:null,timerPaused:!1}):e);return i?o:e}),o(e=>{let t=[...e].reverse().find(e=>b(e.name)&&e.timerRunning);return R(t?.id??null),e})}},[X,v]),(0,r.useEffect)(()=>{if(!X||!T)return;let e=window.setInterval(()=>{p(e=>{let t=Date.now(),r=!1,a=e.map(e=>{if(e.id!==T||"targetGains"!==e.categoryKey||!e.timerRunning||!e.timerStartTs)return e;let a=Math.max(0,Math.floor((t-e.timerStartTs)/1e3));return a<=0?e:(r=!0,{...e,timerSeconds:(e.timerSeconds??0)+a,timerStartTs:t})});if(r){let e=y(a);W(e),A((0,c.getFocusScore)(e))}return r?a:e})},1e3);return()=>window.clearInterval(e)},[T,X]),(0,r.useEffect)(()=>{let e=y(l);W(e),A((0,c.getFocusScore)(e))},[l]),(0,r.useEffect)(()=>{if(!X||!I)return;let e=window.setInterval(()=>{let e=Date.now();o(t=>{let r=!1,a=t.map(t=>{if(t.id!==I||!b(t.name)||!t.timerRunning||!t.timerStartTs)return t;let a=Math.max(0,Math.floor((e-t.timerStartTs)/1e3));return a<=0?t:(r=!0,{...t,timerSeconds:(t.timerSeconds??0)+a,timerStartTs:e})});return r?a:t})},1e3);return()=>window.clearInterval(e)},[I,X]),(0,r.useEffect)(()=>{let e=!0,t=g;return t||(t=new Date().toISOString().slice(0,10)),(0,i.loadPersistedState)(t).then(t=>{if(!e)return;let r=Date.now(),a=e=>e.map(e=>{let t={...e,justAdded:!1,timerPaused:e.timerPaused??!1};if("targetGains"===t.categoryKey){let e=t.timerSeconds??0;if(t.timerRunning&&X&&t.timerStartTs){let a=Math.max(0,Math.floor((r-t.timerStartTs)/1e3));t={...t,timerSeconds:e+a,timerStartTs:r,timerRunning:!0}}else t={...t,timerSeconds:e,timerStartTs:null,timerRunning:!1}}else if("deduction"===t.scoreType&&b(t.name)){let e=t.timerSeconds??0;if(t.timerRunning&&X&&t.timerStartTs){let a=Math.max(0,Math.floor((r-t.timerStartTs)/1e3));t={...t,timerSeconds:e+a,timerStartTs:r,timerRunning:!0}}else t={...t,timerSeconds:e,timerStartTs:null,timerRunning:!1}}return t});o(a(t.deductions??[]));let n=a(t.gains??[]),l=new Set(n.filter(e=>e.weeklyGoalId&&!e.weeklyRewardId).map(e=>e.weeklyGoalId));(0,i.loadWeeklyGoals)(M).then(e=>{let t=!1,r={...e.goals};l.forEach(e=>{e&&r[e]&&r[e].rewarded&&(n.some(t=>t.weeklyRewardId&&t.weeklyRewardId.includes(e))||(r[e].rewarded=!1,t=!0))}),t&&((0,i.saveWeeklyGoals)(M,{goals:r}),B({goals:r}))}).catch(()=>{}),p(n),w(!0)}).catch(e=>{console.error("Failed to load persisted state:",e),w(!0)}),()=>{e=!1}},[g,X]),(0,r.useEffect)(()=>{v&&g&&(0,i.savePersistedState)(g,e,l)},[e,l,v,g]),(0,r.useEffect)(()=>{if(!v||!M)return;let e=(0,c.getWeeklyGoals)(),t=[];e.forEach(e=>{let r=l.filter(t=>t.weeklyGoalId===e.id&&!t.weeklyRewardId).length;t.push({goalId:e.id,count:r,rewarded:r>=e.targetCount})});let r=!1,a={...H.goals};if(t.forEach(({goalId:e,count:t,rewarded:n})=>{let i=H.goals[e]??{count:0,rewarded:!1};(i.count!==t||n&&!i.rewarded)&&(r=!0,a[e]={count:t,rewarded:i.rewarded||n},console.log("[DragDropBox] Updating weekly goal:",e,"count:",t,"rewarded:",i.rewarded||n))}),r){let e={goals:a};B(e),(0,i.saveWeeklyGoals)(M,e),console.log("[DragDropBox] Notifying weekly goals update"),setTimeout(()=>{L.current?.()},0)}},[l,v,M]);let V=()=>{z.current&&(window.clearTimeout(z.current),z.current=null),_(!1)},Y=(e,t)=>{"gain"===t?(C(t=>t===e?null:t),p(t=>t.map(t=>{if(t.id!==e||"targetGains"!==t.categoryKey||!t.timerRunning)return t;let r=Date.now(),a=t.timerStartTs?Math.max(0,Math.floor((r-t.timerStartTs)/1e3)):0;return{...t,timerSeconds:(t.timerSeconds??0)+a,timerRunning:!1,timerStartTs:null,timerPaused:!0}}))):(R(t=>t===e?null:t),o(t=>t.map(t=>{if(t.id!==e||!b(t.name)||!t.timerRunning)return t;let r=Date.now(),a=t.timerStartTs?Math.max(0,Math.floor((r-t.timerStartTs)/1e3)):0;return{...t,timerSeconds:(t.timerSeconds??0)+a,timerRunning:!1,timerStartTs:null,timerPaused:!0}})))},q=(e,t)=>{"gain"===t?(C(e),p(t=>t.map(t=>"targetGains"!==t.categoryKey?t:t.id===e?t.timerRunning?t:{...t,timerRunning:!0,timerStartTs:Date.now(),timerPaused:!1}:{...t,timerRunning:!1,timerStartTs:null,timerPaused:!1}))):(R(e),o(t=>t.map(t=>b(t.name)?t.id===e?t.timerRunning?t:{...t,timerRunning:!0,timerStartTs:Date.now(),timerPaused:!1}:{...t,timerRunning:!1,timerStartTs:null,timerPaused:!1}:t)))},Q=(e,r)=>{var n;let l,s=f(e),d=!!e.criteria&&e.criteria.length>0,g="targetGains"===e.categoryKey&&"gain"===e.scoreType,y=g&&T===e.id,S=x(e.timerSeconds??0),v=e.weeklyGoalId?(0,c.getWeeklyGoalById)(e.weeklyGoalId):void 0,w=v&&H.goals[e.weeklyGoalId]?H.goals[e.weeklyGoalId]:void 0,j=v?v.segmentCount||v.targetCount:0;v&&(w?.count,v.targetCount);let _="deduction"===e.scoreType&&(n=e.name,l=u.default.deductions.items.find(e=>e.name===n),l?.type==="fixed"),D="deduction"===e.scoreType&&b(e.name),k="deduction"===e.scoreType&&h(e.name),C=t=>{if(!X)return;let r=Math.max(0,(e.count??1)+t);0===r?o(t=>t.filter(t=>t.id!==e.id)):o(t=>t.map(t=>t.id===e.id?{...t,count:r}:t))};return(0,t.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:"8px",padding:"8px 10px",borderBottom:"1px solid #1f2937"},className:`${a.default.entry} ${e.justAdded?a.default.entryHighlight:""}`,children:k?E===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#e5e7eb",minWidth:"fit-content"},children:"Expense"}),(0,t.jsx)("input",{type:"text",value:e.customDescription??"",onChange:t=>{var r;return r=t.target.value,void(X&&o(t=>t.map(t=>t.id===e.id?{...t,customDescription:r}:t)))},placeholder:"Description",disabled:!X,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=e.currentTarget.nextElementSibling;t?.focus()}},style:{flex:1,padding:"6px 8px",borderRadius:"4px",border:"1px solid #334155",backgroundColor:X?"#1f2937":"#111827",color:X?"#e5e7eb":"#64748b",fontSize:"13px",outline:"none",transition:"border-color 0.2s",cursor:X?"text":"not-allowed"},onFocus:e=>{e.target.style.borderColor="#0ea5e9"},onBlur:e=>{e.target.style.borderColor="#334155"}}),(0,t.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:e.customScore??0,onChange:t=>(t=>{if(!X)return;let r=Number(t)||0;o(t=>t.map(t=>t.id===e.id?{...t,customScore:r}:t))})(t.target.value),placeholder:"0",disabled:!X,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),N(null))},style:{width:"60px",padding:"6px 8px",borderRadius:"4px",border:"1px solid #334155",backgroundColor:X?"#1f2937":"#111827",color:X?"#e5e7eb":"#64748b",fontSize:"13px",outline:"none",transition:"border-color 0.2s",cursor:X?"text":"not-allowed",textAlign:"center"},onFocus:e=>{e.target.style.borderColor="#0ea5e9"},onBlur:e=>{e.target.style.borderColor="#334155"}}),(0,t.jsx)("button",{onClick:()=>{N(null)},style:{border:"none",background:"transparent",color:X?"#10b981":"#64748b",cursor:X?"pointer":"not-allowed",fontSize:"14px",padding:"2px 6px"},disabled:!X,"aria-label":"Save",title:"Save changes",children:"âœ“"}),(0,t.jsx)("button",{onClick:()=>{X&&o(t=>t.filter(t=>t.id!==e.id))},style:{border:"none",background:"transparent",color:X?"#94a3b8":"#64748b",cursor:X?"pointer":"not-allowed",fontSize:"12px",padding:"2px 6px"},disabled:!X,"aria-label":"Remove item",children:"âœ•"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#e5e7eb"},children:e.customDescription??"Expense"}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:"auto"},children:[(0,t.jsx)("button",{onClick:()=>{X&&N(e.id)},style:{border:"none",background:"transparent",color:X?"#60a5fa":"#64748b",cursor:X?"pointer":"not-allowed",fontSize:"12px",padding:"2px 6px"},disabled:!X,"aria-label":"Edit",title:"Edit expense",children:"âœŽ"}),(0,t.jsx)(m,{value:s}),(0,t.jsx)("button",{onClick:()=>{X&&o(t=>t.filter(t=>t.id!==e.id))},style:{border:"none",background:"transparent",color:X?"#94a3b8":"#64748b",cursor:X?"pointer":"not-allowed",fontSize:"12px",padding:"2px 6px"},disabled:!X,"aria-label":"Remove item",children:"âœ•"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#e5e7eb"},children:e.name}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:"auto"},children:[_&&(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,t.jsx)("button",{onClick:()=>C(-1),disabled:!X||(e.count??1)<=1,style:{border:"1px solid #475569",background:X&&(e.count??1)>1?"#1f2937":"#111827",color:X&&(e.count??1)>1?"#94a3b8":"#64748b",padding:"2px 6px",borderRadius:"4px",cursor:X&&(e.count??1)>1?"pointer":"not-allowed",fontSize:"12px",fontWeight:500},"aria-label":"Decrease count",children:"âˆ’"}),(0,t.jsx)("span",{style:{minWidth:"20px",textAlign:"center",fontSize:"12px",fontWeight:500,color:"#cbd5e1"},children:e.count??1}),(0,t.jsx)("button",{onClick:()=>C(1),disabled:!X,style:{border:"1px solid #475569",background:X?"#1f2937":"#111827",color:X?"#94a3b8":"#64748b",padding:"2px 6px",borderRadius:"4px",cursor:X?"pointer":"not-allowed",fontSize:"12px",fontWeight:500},"aria-label":"Increase count",children:"+"})]}),D&&(0,t.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 8px",borderRadius:"6px",border:"1px solid #1f2937",background:"#111827",color:"#94a3b8",fontSize:"12px"},children:[(0,t.jsx)("span",{style:{fontVariantNumeric:"tabular-nums",fontWeight:600},children:S}),X&&e.timerRunning&&(0,t.jsx)("button",{onClick:()=>Y(e.id,"deduction"),style:{border:"none",background:"transparent",color:"#e5e7eb",cursor:"pointer",fontSize:"14px",lineHeight:1},"aria-label":"Pause timer",children:"â¸"}),X&&!e.timerRunning&&(0,t.jsx)("button",{onClick:()=>q(e.id,"deduction"),style:{border:"none",background:"transparent",color:"#e5e7eb",cursor:"pointer",fontSize:"14px",lineHeight:1},"aria-label":"Resume timer",children:"â–¶"})]}),g&&(0,t.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 8px",borderRadius:"6px",border:"1px solid #1f2937",background:y?"#0b1220":"#111827",color:y?"#e5e7eb":"#94a3b8",fontSize:"12px"},children:[(0,t.jsx)("span",{style:{fontVariantNumeric:"tabular-nums",fontWeight:600},children:S}),y&&X&&e.timerRunning&&(0,t.jsx)("button",{onClick:()=>Y(e.id,"gain"),style:{border:"none",background:"transparent",color:"#e5e7eb",cursor:"pointer",fontSize:"14px",lineHeight:1},"aria-label":"Pause timer",children:"â¸"}),y&&X&&!e.timerRunning&&(0,t.jsx)("button",{onClick:()=>q(e.id,"gain"),style:{border:"none",background:"transparent",color:"#e5e7eb",cursor:"pointer",fontSize:"14px",lineHeight:1},"aria-label":"Resume timer",children:"â–¶"})]}),g&&(0,t.jsx)("button",{onClick:()=>{X&&("deduction"===r?o(t=>t.map(t=>t.id===e.id?{...t,bonusActive:!t.bonusActive}:t)):p(t=>t.map(t=>t.id===e.id?{...t,bonusActive:!t.bonusActive}:t)))},style:{border:"none",background:X?e.bonusActive?"#2d1a1e":"#113227":"#1f2937",color:X?e.bonusActive?"#fca5a5":"#6ee7b7":"#64748b",padding:"4px 8px",borderRadius:"4px",cursor:X?"pointer":"not-allowed",fontWeight:600,fontSize:"12px"},disabled:!X,"aria-label":"Toggle bonus",children:e.bonusActive?"âœ•":"+10"}),d&&"gain"===e.scoreType?(0,t.jsxs)("div",{style:{position:"relative",display:"inline-flex",alignItems:"center"},children:[(0,t.jsx)("select",{value:e.selectedIndex??0,onChange:t=>{var a,n;return a=e.id,n=parseInt(t.target.value,10),void("deduction"===r?o(e=>e.map(e=>e.id===a?{...e,selectedIndex:n}:e)):p(e=>e.map(e=>e.id===a?{...e,selectedIndex:n}:e)))},style:{fontSize:"12px",padding:"4px 28px 4px 8px",borderRadius:"4px",border:"none",backgroundColor:X?"#113227":"#1f2937",color:X?"#6ee7b7":"#64748b",fontWeight:500,cursor:X?"pointer":"not-allowed",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",outline:"none"},disabled:!X,children:e.criteria.map((r,a)=>(0,t.jsxs)("option",{value:a,children:[r.score," pts"]},`${e.id}-opt-${a}`))}),(0,t.jsx)("span",{style:{position:"absolute",right:"8px",pointerEvents:"none",color:"#e5e7eb",fontSize:"12px"},children:"â–¾"})]}):(0,t.jsx)(m,{value:s}),(0,t.jsx)("button",{onClick:()=>{X&&("deduction"===r?o(t=>t.filter(t=>t.id!==e.id)):(e.weeklyRewardId&&B(t=>{let r=e.weeklyRewardId.split("-")[1];if(!r)return t;let a={goals:{...t.goals,[r]:{count:t.goals[r]?.count??0,rewarded:!1}}};return M&&(0,i.saveWeeklyGoals)(M,a),a}),p(t=>t.filter(t=>t.id!==e.id))))},style:{border:"none",background:"transparent",color:X?"#94a3b8":"#64748b",cursor:X?"pointer":"not-allowed",fontSize:"12px",padding:"2px 6px"},disabled:!X,"aria-label":"Remove item",children:"âœ•"})]}),v&&j>0&&(0,t.jsxs)("div",{style:{gridColumn:"1 / -1",display:"flex",alignItems:"center",gap:"8px",marginTop:"4px",justifyContent:"flex-end"},children:[(0,t.jsx)("div",{style:{display:"grid",gridTemplateColumns:`repeat(${j}, 1fr)`,gap:"4px",width:"100%",maxWidth:"200px"},children:Array.from({length:j}).map((r,a)=>{let n=a<(w?.count??0);return(0,t.jsx)("div",{style:{height:"6px",borderRadius:"4px",background:n?"#22c55e":"#1f2937",border:"1px solid #1f2937"}},`${e.id}-seg-${a}`)})}),(0,t.jsxs)("span",{style:{color:"#cbd5e1",fontSize:"12px",whiteSpace:"nowrap",marginLeft:"8px"},children:[Math.min(w?.count??0,v.targetCount),"/",v.targetCount]})]})]})},`${r}-${e.id}`)};return(0,t.jsxs)("div",{className:a.default.section,style:{border:"2px dashed #2d3b55",borderRadius:"8px",padding:"16px",minHeight:"360px",backgroundColor:"#0f1625",color:"#e5e7eb",boxShadow:"0 6px 20px rgba(0,0,0,0.35)"},onDragOver:e=>{e.preventDefault()},onDrop:e=>{if(e.preventDefault(),!X)return;let t=e.dataTransfer.getData("application/json");if(t||(t=e.dataTransfer.getData("text/plain")),t)try{let e=JSON.parse(t),r={id:e.id,name:e.name,scoreType:e.scoreType,criteria:e.criteria,baseType:e.baseType,fixedScore:e.score,selectedIndex:0,categoryKey:e.categoryKey,weeklyGoalId:e.weeklyGoalId,bonusActive:!1,timerSeconds:0,timerRunning:!1,timerStartTs:null,timerPaused:!1,count:1,customDescription:"Expense",customScore:0};"deduction"===r.scoreType?o(e=>{let t=r;if(h(r.name))t={...r,id:`${r.id}-${Date.now()}-${Math.random()}`};else if(e.some(e=>e.id===r.id))return e;let a=Date.now(),n={...t,justAdded:!0};return b(t.name)&&(n={...n,timerRunning:!0,timerStartTs:a},R(t.id)),h(t.name)&&N(t.id),setTimeout(()=>{o(e=>e.map(e=>e.id===n.id?{...e,justAdded:!1}:e))},950),[...e,n]}):(p(e=>{if(e.some(e=>e.id===r.id))return e;let t=Date.now(),a={...r,justAdded:!0,timerRunning:!0,timerStartTs:t},n=[...e.map(e=>"targetGains"===e.categoryKey?{...e,timerRunning:!1,timerStartTs:null,timerPaused:!1}:e),a];return setTimeout(()=>{p(e=>e.map(e=>e.id===a.id?{...e,justAdded:!1}:e))},950),n}),e.weeklyGoalId&&setTimeout(()=>{},0))}catch(e){}},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,t.jsx)("div",{className:a.default.dateChip,onClick:()=>k(!0),style:{cursor:"pointer"},role:"button",tabIndex:0,title:"Click to select date",children:(e=>{if(!e)return"";let[t,r,a]=e.split("-");return`${t}-${r}-${a}`})(g)||"â€”"}),(0,t.jsx)("button",{onClick:()=>{w(!1)},style:{background:"transparent",border:"1px solid #334155",color:"#94a3b8",padding:"4px 8px",borderRadius:"6px",fontSize:"12px",cursor:"pointer",transition:"all 120ms ease",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.1)",e.currentTarget.style.color="#3b82f6",e.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.color="#94a3b8",e.currentTarget.style.borderColor="#334155"},"aria-label":"Refresh data",title:"Refresh data",children:"â†»"})]}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[!X&&(0,t.jsx)("span",{style:{background:"#1f2937",color:"#94a3b8",border:"1px solid #334155",padding:"4px 8px",borderRadius:"6px",fontSize:"12px"},children:"ðŸ”’ locked"}),!U()&&(0,t.jsx)("button",{onClick:()=>{J(new Date().toISOString().slice(0,10))},style:{background:"transparent",border:"1px solid #334155",color:"#94a3b8",padding:"4px 8px",borderRadius:"6px",fontSize:"12px",cursor:"pointer",transition:"all 120ms ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.1)",e.currentTarget.style.color="#3b82f6",e.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.color="#94a3b8",e.currentTarget.style.borderColor="#334155"},"aria-label":"Return to today",children:"current"}),(0,t.jsx)("div",{style:{color:"#94a3b8",fontSize:"12px"},children:"daily record"})]})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1px 1fr",gap:"16px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:"8px",color:"#e5e7eb"},children:"Deductions"}),0===e.length?(0,t.jsx)("div",{style:{color:"#94a3b8",fontSize:"12px"},children:X?"Drop items here":"Read-only"}):e.map((e,r)=>(0,t.jsx)("div",{children:Q(e,"deduction")},`${r}-${e.id}`))]}),(0,t.jsx)("div",{style:{backgroundColor:"#1f2937",width:"1px"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600,marginBottom:"8px",color:"#e5e7eb"},children:"Gains"}),G>0&&(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:"8px",padding:"8px 10px",borderBottom:"1px solid #1f2937",backgroundColor:"rgba(34, 197, 94, 0.08)",borderRadius:"4px",marginBottom:"4px"},children:[(0,t.jsx)("span",{style:{fontWeight:500,fontSize:"14px",color:"#6ee7b7"},children:"focus"}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,t.jsx)("span",{style:{fontVariantNumeric:"tabular-nums",fontSize:"12px",color:"#94a3b8"},children:x(G)}),(0,t.jsxs)("span",{style:{backgroundColor:"#113227",color:"#6ee7b7",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:500},children:[$," pts"]})]})]}),0===l.length?(0,t.jsx)("div",{style:{color:"#94a3b8",fontSize:"12px"},children:X?"Drop items here":"Read-only"}):l.map((e,r)=>(0,t.jsx)("div",{children:Q(e,"gain")},`${r}-${e.id}`))]})]}),(0,t.jsxs)("div",{style:{marginTop:"12px",borderTop:"1px solid #1f2937",paddingTop:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("span",{style:{color:"#94a3b8",fontSize:"12px"},children:"Total"}),(0,t.jsx)(m,{value:l.reduce((e,t)=>e+f(t),0)-e.reduce((e,t)=>e+f(t),0)})]}),(0,t.jsx)("button",{className:`${a.default.clearButton} ${j?a.default.clearButtonActive:""}`,onPointerDown:()=>{z.current&&window.clearTimeout(z.current),_(!0),z.current=window.setTimeout(()=>{z.current=null,o([]),p([]),g&&(0,i.clearPersistedState)(g),_(!1)},3e3)},onPointerUp:V,onPointerLeave:V,onPointerCancel:V,disabled:!X,"aria-label":"Clear all dropped items",children:"Clear"}),D&&(0,t.jsx)(s,{selectedDate:g,onDateSelect:J,onClose:()=>k(!1)})]})}e.s(["default",()=>S],60057)},88797,e=>{e.v({heatmap:"HistoryHeatmap-module__vd62ca__heatmap",legend:"HistoryHeatmap-module__vd62ca__legend",legendBox:"HistoryHeatmap-module__vd62ca__legendBox",row:"HistoryHeatmap-module__vd62ca__row",tile:"HistoryHeatmap-module__vd62ca__tile",tileFuture:"HistoryHeatmap-module__vd62ca__tileFuture",tileLevel1:"HistoryHeatmap-module__vd62ca__tileLevel1",tileLevel2:"HistoryHeatmap-module__vd62ca__tileLevel2",tileLevel3:"HistoryHeatmap-module__vd62ca__tileLevel3",tileNegative1:"HistoryHeatmap-module__vd62ca__tileNegative1",tileNegative2:"HistoryHeatmap-module__vd62ca__tileNegative2",tileNegative3:"HistoryHeatmap-module__vd62ca__tileNegative3",tileNegativeLight:"HistoryHeatmap-module__vd62ca__tileNegativeLight"})},70030,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(88797),n=e.i(55167),i=e.i(32833),o=e.i(5987),l=e.i(89050),s=e.i(37372);function d(e){if("deduction"===e.scoreType){let t=s.default.deductions.items.find(t=>t.name===e.name);if(t?.type==="custom")return-(e.customScore??0)}if("deduction"===e.scoreType&&"targetGains"!==e.categoryKey){let t=s.default.deductions.items.find(t=>t.name===e.name);if(t?.type==="fixed")return(t.score??0)*(e.count??1);if(t?.type==="tiered"&&"duration"===t.baseType)return(0,l.getDeductionScore)(t,e.timerSeconds??0)}if(e.criteria&&e.criteria.length>0){let t=Math.max(0,e.selectedIndex??0);return(e.criteria[t]?.score??0)+10*!!e.bonusActive}return(e.fixedScore??0)+10*!!e.bonusActive}function c({onDateSelect:e}){let[l,s]=(0,r.useState)([]),{setSelectedDate:c}=(0,i.useSelectedDate)(),{selectedIds:u}=(0,o.useDroppedItems)(),p=Array.from(u);return(0,r.useEffect)(()=>{let e=!0,t=new Date;return(0,n.listAllStates)().then(r=>{if(!e)return;let a=new Map;r.forEach(({dateKey:e,state:t})=>{a.set(e,(t.gains??[]).reduce((e,t)=>e+d(t),0)-(t.deductions??[]).reduce((e,t)=>e+d(t),0))});let n=new Date(t);n.setDate(t.getDate()-69);let i=n.getDay();n.setDate(n.getDate()-i);let o=new Date(t);o.setDate(t.getDate()+14);let l=Math.ceil((o.getTime()-n.getTime())/6048e5),c=[];for(let e=0;e<l;e++)for(let r=0;r<7;r++){let i=new Date(n);i.setDate(n.getDate()+7*e+r);let o=i.toISOString().slice(0,10),l=i>t;c.push({dateKey:o,score:l?0:a.get(o)??0,isFuture:l})}s(c)}),()=>{e=!1}},[p.length]),(0,t.jsx)("div",{className:a.default.heatmap,children:l.map(r=>{var n;return(0,t.jsx)("div",{className:(n=r).isFuture?`${a.default.tile} ${a.default.tileFuture}`:n.score<0?n.score<=-100?`${a.default.tile} ${a.default.tileNegative3}`:n.score<=-50?`${a.default.tile} ${a.default.tileNegative2}`:n.score<=-25?`${a.default.tile} ${a.default.tileNegative1}`:`${a.default.tile} ${a.default.tileNegativeLight}`:n.score>=100?`${a.default.tile} ${a.default.tileLevel3}`:n.score>=50?`${a.default.tile} ${a.default.tileLevel2}`:n.score>=25?`${a.default.tile} ${a.default.tileLevel1}`:a.default.tile,title:`${r.dateKey} \xb7 ${r.score} pts${r.isFuture?" Â· upcoming":""}`,onClick:()=>{r.isFuture||(e?e(r.dateKey):c(r.dateKey))},role:r.isFuture?void 0:"button",tabIndex:r.isFuture?void 0:0,style:{cursor:r.isFuture?"default":"pointer",transition:"all 120ms ease"}},r.dateKey)})})}e.s(["default",()=>c])},54284,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(55167);function n(){let[e,n]=(0,r.useState)(!1),[i,o]=(0,r.useState)(!1),l=async()=>{try{n(!0);let e=await (0,a.exportAllData)(),t=new Date,r=t.toISOString().slice(0,10),i=t.toTimeString().slice(0,5).replace(":",""),o=`siphor-backup-${r}-${i}.json`,l=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(l),d=document.createElement("a");d.href=s,d.download=o,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(s),alert("âœ“ Data exported successfully")}catch(e){console.error("Export failed:",e),alert("âœ— Export failed. Please try again.")}finally{n(!1)}},s={padding:"8px 16px",borderRadius:"8px",fontSize:"13px",cursor:"pointer",transition:"all 150ms ease",fontWeight:600,border:"none"};return(0,t.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,t.jsx)("button",{onClick:()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{let t=e.target.files?.[0];if(t)try{o(!0);let e=await t.text(),r=JSON.parse(e);if(!r.version||!r.exportDate||!Array.isArray(r.data))throw Error("Invalid data format");if(!confirm(`Import data from ${r.exportDate}?
This contains ${r.data.length} day(s) of records.
Existing data for those dates will be overwritten.`))return void o(!1);await (0,a.importAllData)(r),alert(`âœ“ Successfully imported ${r.data.length} day(s) of data.
Please refresh the page to see changes.`),window.location.reload()}catch(e){console.error("Import failed:",e),alert("âœ— Import failed. Please check the file format.")}finally{o(!1)}},e.click()},disabled:i,style:{...s,background:i?"rgba(34, 197, 94, 0.2)":"rgba(34, 197, 94, 0.15)",color:"#6ee7b7",border:"1px solid rgba(34, 197, 94, 0.3)",opacity:i?.6:1},onMouseEnter:e=>{i||(e.currentTarget.style.background="rgba(34, 197, 94, 0.25)",e.currentTarget.style.borderColor="rgba(34, 197, 94, 0.5)")},onMouseLeave:e=>{e.currentTarget.style.background="rgba(34, 197, 94, 0.15)",e.currentTarget.style.borderColor="rgba(34, 197, 94, 0.3)"},title:"Import data from JSON file",children:i?"Importing...":"Import"}),(0,t.jsx)("button",{onClick:l,disabled:e,style:{...s,background:e?"rgba(59, 130, 246, 0.2)":"rgba(59, 130, 246, 0.15)",color:"#60a5fa",border:"1px solid rgba(59, 130, 246, 0.3)",opacity:e?.6:1},onMouseEnter:t=>{e||(t.currentTarget.style.background="rgba(59, 130, 246, 0.25)",t.currentTarget.style.borderColor="rgba(59, 130, 246, 0.5)")},onMouseLeave:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.15)",e.currentTarget.style.borderColor="rgba(59, 130, 246, 0.3)"},title:"Export all data to JSON file",children:e?"Exporting...":"Export"})]})}e.s(["default",()=>n])}]);