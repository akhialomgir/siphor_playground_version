# 计分系统数据结构说明

## 概述

计分系统采用统一的 JSON 结构来管理不同类型的评分项，包括扣分项（deductions）、常规增益项（regularGains）和目标增益项（targetGains）。所有时间值统一采用秒级单位，确保数据的一致性和易于维护。

## 核心结构

### 顶层三大类

```json
{
  "deductions": { },      // 扣分项
  "regularGains": { },    // 常规增益项
  "targetGains": { }      // 目标增益项
}
```

## 大类级别属性

每个大类都包含两个关键属性：

| 属性 | 说明 | 可选值 |
|------|------|--------|
| `scoreType` | 分数性质 | `"gain"`（增益）/ `"deduction"`（扣分） |
| `items` | 该类别下的所有项目数组 | 数组 |

**示例**：
```json
{
  "deductions": {
    "scoreType": "deduction",
    "items": [...]
  },
  "regularGains": {
    "scoreType": "gain",
    "items": [...]
  }
}
```

## 项目（Item）级别属性

### 基础属性（所有项目都有）

| 属性 | 类型 | 说明 |
|------|------|------|
| `id` | string | 项目唯一标识，格式为 `"0"` 到 `"5"` 的数字 |
| `name` | string | 项目名称，如 "bili"、"focus"、"programming" |
| `type` | string | 评分方式类型 |
| `score` | number | 基础分值（对于 fixed 类型是最终分值） |

### type 类型说明

#### 1. `"fixed"` - 固定分数

**使用场景**：完成该项就得分固定分值

**属性**：仅需基础属性

**示例**：
```json
{
  "id": "0",
  "name": "bili",
  "score": 15,
  "type": "fixed"
}
```

#### 2. `"tiered"` - 分层评分

**使用场景**：根据时间或完成程度不同，得分不同（如专注时间越长分越高）

**额外属性**：
- `baseType` - 基于何种类型的时间值
  - `"duration"` - 时长类型（从 0 开始计时）
- `criteria` - 评分标准数组，每个标准包含：
  - `time` - 时间阈值（秒数）
  - `score` - 该阈值对应的分数

**示例**：
```json
{
  "id": "0",
  "name": "focus",
  "type": "tiered",
  "baseType": "duration",
  "criteria": [
    { "time": 3600, "score": 5 },      // 专注 1 小时得 5 分
    { "time": 7200, "score": 10 },     // 专注 2 小时得 10 分
    { "time": 10800, "score": 20 }     // 专注 3 小时得 20 分
  ]
}
```

#### 3. `"conditional"` - 条件评分

**使用场景**：根据特定条件（如时间点）决定是否得分

**额外属性**：
- `baseType` - 基于何种类型的时间值
  - `"relativeTime"` - 相对时间类型（基于今天的具体时间点）
- `criteria` - 条件数组，每个条件包含：
  - `time` - 时间点（秒数，从今天 00:00:00 开始计算）
  - `comparison` - 比较方式（`"before"` 表示在该时间之前）
  - `score` - 满足条件时得分

**示例**：
```json
{
  "id": "2",
  "name": "sleep",
  "type": "conditional",
  "baseType": "relativeTime",
  "criteria": [
    { "time": 79200, "comparison": "before", "score": 5 },    // 在 22:00 前睡觉得 5 分
    { "time": 82800, "comparison": "before", "score": 10 }    // 在 23:00 前睡觉得 10 分
  ]
}
```

## 时间值换算

所有时间值都以**秒数**表示，便于统一处理和计算：

### 时长类型（duration）

| 时间 | 秒数 |
|------|------|
| 30 分钟 | 1800 |
| 1 小时 | 3600 |
| 2 小时 | 7200 |
| 3 小时 | 10800 |
| 4 小时 | 14400 |
| 5 小时 | 18000 |

### 相对时间类型（relativeTime）

从今天 00:00:00 起算的秒数：

| 时间点 | 秒数 |
|--------|------|
| 22:00 | 79200 |
| 23:00 | 82800 |

**计算方式**：`小时 × 3600 + 分钟 × 60 + 秒数`

例如：22:00 = 22 × 3600 + 0 × 60 + 0 = 79200 秒

## 三大类别说明

### 1. deductions（扣分项）

**特点**：完成某项不良行为就被扣分

**当前项目**：
- bili（账号被封）：固定扣 15 分
- game（玩游戏）：玩 30 分钟扣 10 分（分层）
- sosx（社交媒体）：固定扣 50 分

### 2. regularGains（常规增益项）

**特点**：日常行为中可以获得的分数

**当前项目**：
- focus（专注学习）：根据专注时长分层获分，最高 35 分
- exercise（运动）：固定得 10 分
- sleep（早睡）：在指定时间前睡觉获分，最高 10 分

### 3. targetGains（目标增益项）

**特点**：完成特定目标任务获得分数

**当前项目**：
- programming（编程）：15 分
- algorithm（算法）：15 分
- interview（面试准备）：20 分
- paint（绘画）：10 分
- reading（阅读）：5 分
- mindfulness（冥想）：10 分

## 设计原则

### 1. 简化 ID

使用简单的数字 ID（0-5）而非复杂的前缀 ID，便于维护和扩展

### 2. 统一的时间单位

全部采用秒级单位，避免混乱的字符串格式（如 "1h"、"30m"）

### 3. 分离 baseType

通过 `baseType` 明确标注时间的含义：
- `"duration"` - 累计时长
- `"relativeTime"` - 今天的具体时间点

### 4. 统一的 criteria 结构

将原来的 `tiers` 和 `conditions` 合并为 `criteria`，提供一致的接口

### 5. 文本化的比较操作符

使用 `"before"` 等文本而非 `"<"` 等符号，提高代码可读性

## 扩展建议

未来如需添加新功能，可以：

1. **添加新的 baseType**（如 `"absoluteTime"` 表示固定日期）
2. **扩展 comparison 值**（如 `"after"`、`"between"` 等）
3. **添加其他项目属性**（如 `"description"`、`"category"` 等）
4. **引入权重系统**（如 `"weight"` 字段调整分数影响）

所有这些扩展都不会破坏现有结构，保持向后兼容性。
